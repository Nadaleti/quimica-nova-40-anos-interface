<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>QuimicaNovaInterface</title>
    <base href="/">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <!-- Neovis.js -->
    <script src="https://rawgit.com/neo4j-contrib/neovis.js/master/dist/neovis.js"></script>

    <script type="text/javascript">
        let viz;
        let isCommunityAlg = false;
    
        function draw() {
            // Configuração do Neovis.js
            const config = {
                container_id: "visualization",
                server_url: "bolt://localhost:7687",
                server_user: "neo4j",
                server_password: "4321",
                labels: {
                    "Keyword": {
                        "caption": "keyword",
                        "size": "numOccurrences",
                        "community": "community"
                    }
                },
                relationships: {
                    "RELATED": {
                        //"thickness": "weight",
                        "caption": false
                    }
                },
               
                initial_cypher: document.getElementById('communityAlg').value 
            };
    
            viz = new NeoVis.default(config);
            viz.render();

            document.getElementById('loading').style.display = 'block';
            document.getElementById('empty-result').style.display = 'none';

            // Escuta o evento de 'complete' da query
            viz.registerOnEvent('completed', (e) => {
                if (isCommunityAlg) {
                    // Se o que terminou de executar for o algoritmo de comunidade, executa a query de fato
                    isCommunityAlg = false;
                    viz.renderWithCypher(document.getElementById('query').value);
                } else {
                    // Caso seja a query, verifica se houve resultado
                    if (e.record_count == 0) {
                        // Se não houver resultado, exibe mensagem de que não foi encontrado resultado
                        document.getElementById('empty-result').style.display = 'block';
                        document.getElementById('loading').style.display = 'none'
                    } else {
                        // Caso haja resultado, continua o load até o carregamento visual do grafo
                        setInterval(() => document.getElementById('loading').style.display = 'none', 10000);
                    }
                }
            });
        }

        function filter() {
            viz.renderWithCypher(document.getElementById('communityAlg').value);
            isCommunityAlg = true;

            document.getElementById('loading').style.display = 'block';
            document.getElementById('empty-result').style.display = 'none';
        }
    </script>
</head>

<body onload="draw()">
    <app-root></app-root>
</body>

</html>